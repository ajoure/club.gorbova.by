
# План: Исправление ошибки "out of range for type integer" при создании урока

## Проблема

При создании standalone-урока в строке 381 файла `ContentCreationWizard.tsx`:

```typescript
sort_order: Date.now(), // Use timestamp for reverse chronological order
```

`Date.now()` возвращает `1769554873152` (миллисекунды с 1970), что превышает максимальное значение PostgreSQL INTEGER (~2,147,483,647).

## Решение

Заменить `Date.now()` на безопасное значение для сортировки:

### Вариант 1: Использовать количество существующих уроков + 1

```typescript
// Получить количество уроков в контейнере
const { count } = await supabase
  .from("training_lessons")
  .select("id", { count: "exact", head: true })
  .eq("module_id", containerId);

const sortOrder = (count || 0) + 1;
```

### Вариант 2: Использовать секунды вместо миллисекунд (для обратной хронологии)

```typescript
// Секунды с начала 2025 года (чтобы числа были маленькими)
const baseTime = new Date("2025-01-01").getTime() / 1000; // 1735689600
const sortOrder = Math.floor(Date.now() / 1000) - baseTime;
// Результат: ~21,700,000 (безопасно для INTEGER)
```

### Вариант 3: Простой счётчик с максимальным значением

```typescript
sort_order: 0, // Новые уроки в начале, сортировка по дате создания
```

## Рекомендуемое решение (Вариант 3)

Использовать `sort_order: 0` и полагаться на `created_at` для хронологической сортировки:

```typescript
sort_order: 0, // Позже можно изменить для ручной сортировки
```

При отображении уроков сортировать по `created_at DESC` для обратной хронологии.

## Файл для изменения

| Файл | Изменение |
|------|-----------|
| `src/components/admin/trainings/ContentCreationWizard.tsx` | Строка 381: заменить `Date.now()` на `0` |

## Дополнительно: Проверка отображения уроков

Нужно убедиться, что `useContainerLessons.ts` сортирует по `created_at DESC` для корректного отображения новых уроков сверху.

## Техническое пояснение

- PostgreSQL INTEGER: от -2,147,483,648 до 2,147,483,647
- `Date.now()` в 2026 году: ~1,769,554,873,152 (в миллисекундах)
- Превышение лимита вызывает ошибку "out of range for type integer"

## Результат

Уроки будут создаваться без ошибки, сортировка по дате создания обеспечит правильный порядок отображения (новые сверху).
