
# –ü–ª–∞–Ω: –†—É—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–æ—á–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## –¢–µ–∫—É—â–∏–µ –æ—à–∏–±–∫–∏ (—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞)

| –ö–æ–¥ | –ù–∞–∑–≤–∞–Ω–∏–µ | –ù–∞–π–¥–µ–Ω–æ | –°—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã | –ß—Ç–æ –¥–µ–ª–∞—Ç—å |
|-----|----------|---------|---------------|------------|
| **INV-2A** | –ü–ª–∞—Ç–µ–∂–∏ –±–µ–∑ –∑–∞–∫–∞–∑–æ–≤ | 4 | –ï—Å—Ç—å 4 –ø–ª–∞—Ç–µ–∂–∞ –ø–æ 1 BYN, –∫–æ—Ç–æ—Ä—ã–µ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ –ø–æ–∫—É–ø–∫–∏, –Ω–æ –¥–ª—è –Ω–∏—Ö –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤ | –ü–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ —Ç–µ—Å—Ç–æ–≤—ã–µ (`card_verification`) |
| **INV-3** | –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å—É–º–º | 1 | –ö–ª–∏–µ–Ω—Ç –û–ª—å–≥–∞ –ê–Ω–∞–Ω–µ–≤–∏—á –∑–∞–ø–ª–∞—Ç–∏–ª–∞ 45 BYN, –∞ –∑–∞–∫–∞–∑ –Ω–∞ 55 BYN | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –±—ã–ª–∞ –ª–∏ —Å–∫–∏–¥–∫–∞ –∏–ª–∏ –¥–æ–ø–ª–∞—Ç–∞ |
| **INV-8** | –ù–µ—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ | 3 | 3 –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–∞ –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–≤–æ–∑–≤—Ä–∞—Ç -1 BYN, —Ç–µ—Å—Ç 1 BYN, –ø–æ–∫—É–ø–∫–∞ 250 BYN) | –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é |

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### PATCH-1: –°–ª–æ–≤–∞—Ä—å –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º

**–§–∞–π–ª:** `supabase/functions/nightly-system-health/index.ts`

–î–æ–±–∞–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –∫–æ–¥–æ–≤ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–∞ –ø–æ–Ω—è—Ç–Ω—ã–µ —Ä—É—Å—Å–∫–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è:

```typescript
const INVARIANT_TRANSLATIONS: Record<string, {
  title: string;
  explain: string;
  action: string;
}> = {
  'INV-1': {
    title: '–î—É–±–ª–∏–∫–∞—Ç—ã –ø–ª–∞—Ç–µ–∂–µ–π',
    explain: '–ù–∞–π–¥–µ–Ω—ã –ø–ª–∞—Ç–µ–∂–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º ID –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞',
    action: '–£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –≤ –∞–¥–º–∏–Ω–∫–µ –ø–ª–∞—Ç–µ–∂–µ–π',
  },
  'INV-2A': {
    title: '–ü–ª–∞—Ç–µ–∂–∏ –±–µ–∑ –∑–∞–∫–∞–∑–æ–≤',
    explain: '–î–µ–Ω—å–≥–∏ –ø—Ä–∏—à–ª–∏, –Ω–æ –∑–∞–∫–∞–∑ –Ω–µ —Å–æ–∑–¥–∞–Ω (–ø–æ—Ç–µ—Ä—è —É—á—ë—Ç–∞)',
    action: '–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑—ã –∏–ª–∏ –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ —Ç–µ—Å—Ç–æ–≤—ã–µ',
  },
  'INV-3': {
    title: '–ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å—É–º–º',
    explain: '–°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞',
    action: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–∏–¥–∫–∏ –∏–ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ',
  },
  'INV-7': {
    title: '–†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω —Å bePaid',
    explain: '–°—É–º–º–∞ –≤ –Ω–∞—à–µ–π –±–∞–∑–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ bePaid',
    action: '–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å –≤—ã–ø–∏—Å–∫–æ–π',
  },
  'INV-8': {
    title: '–ù–µ—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏',
    explain: '–ü–ª–∞—Ç–µ–∂–∏ –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–Ω–µ–ø–æ–Ω—è—Ç–Ω–æ —á—Ç–æ —ç—Ç–æ)',
    action: '–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é',
  },
  'INV-9': {
    title: '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å –∑–∞–∫–∞–∑–∞–º–∏',
    explain: '–ü—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—Ä—Ç –æ—à–∏–±–æ—á–Ω–æ —Å–æ–∑–¥–∞–ª–∏ –∑–∞–∫–∞–∑—ã',
    action: '–£–¥–∞–ª–∏—Ç—å –ª–∏—à–Ω–∏–µ –∑–∞–∫–∞–∑—ã',
  },
  'INV-10': {
    title: '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø—ã',
    explain: '–ê–∫—Ç–∏–≤–Ω—ã–µ –¥–æ—Å—Ç—É–ø—ã —Å –∏—Å—Ç—ë–∫—à–∏–º —Å—Ä–æ–∫–æ–º',
    action: '–ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–∏—Å—Ç–∫—É –¥–æ—Å—Ç—É–ø–æ–≤',
  },
  'INV-11': {
    title: '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏',
    explain: '–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ —Å –∏—Å—Ç—ë–∫—à–∏–º —Å—Ä–æ–∫–æ–º',
    action: '–ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–∏—Å—Ç–∫—É –ø–æ–¥–ø–∏—Å–æ–∫',
  },
  'INV-12': {
    title: '–û—à–∏–±–æ—á–Ω—ã–µ —Ä–µ–≤–æ–∫–∏ TG',
    explain: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –¥–æ—Å—Ç—É–ø–æ–º –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ –≥—Ä—É–ø–ø',
    action: '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–ª–µ–Ω—Å—Ç–≤–æ –≤ Telegram',
  },
  'INV-13': {
    title: '–¢—Ä–∏–∞–ª—ã –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞',
    explain: '–û–ø–ª–∞—á–µ–Ω–Ω—ã–π —Ç—Ä–∏–∞–ª –Ω–µ –¥–∞–ª –¥–æ—Å—Ç—É–ø –∫–ª–∏–µ–Ω—Ç—É',
    action: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫',
  },
};
```

### PATCH-2: –§–æ—Ä–º–∞—Ç TG-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º

**–ë—ã–ª–æ:**
```
üö® NIGHTLY CHECK: 3/15 FAILED

FAIL: INV-2A: No business payments without order (STRICT)
  Issues: 4
  Sample: {"id":"919fe5bb-...
```

**–°—Ç–∞–Ω–µ—Ç:**
```
üö® –ù–û–ß–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê: 3 –∏–∑ 15 —Å –æ—à–∏–±–∫–∞–º–∏

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚ùå –ü–ª–∞—Ç–µ–∂–∏ –±–µ–∑ –∑–∞–∫–∞–∑–æ–≤ (INV-2A)
   –ù–∞–π–¥–µ–Ω–æ: 4
   –ü—Ä–æ–±–ª–µ–º–∞: –î–µ–Ω—å–≥–∏ –ø—Ä–∏—à–ª–∏, –Ω–æ –∑–∞–∫–∞–∑ –Ω–µ —Å–æ–∑–¥–∞–Ω
   –î–µ–π—Å—Ç–≤–∏–µ: –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑—ã –∏–ª–∏ –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å

‚ùå –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å—É–º–º (INV-3)
   –ù–∞–π–¥–µ–Ω–æ: 1
   –ü—Ä–æ–±–ª–µ–º–∞: –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ ‚â† —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞
   –î–µ–π—Å—Ç–≤–∏–µ: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–∏–¥–∫–∏ –∏–ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

‚ùå –ù–µ—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (INV-8)
   –ù–∞–π–¥–µ–Ω–æ: 3
   –ü—Ä–æ–±–ª–µ–º–∞: –ü–ª–∞—Ç–µ–∂–∏ –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   –î–µ–π—Å—Ç–≤–∏–µ: –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

‚è± 02.02.2026, 06:00 –ú–∏–Ω—Å–∫
üìä –í—Ä–µ–º—è: 5.3 —Å–µ–∫
üîó –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: /admin/system-health
```

**–ü—Ä–∏ —É—Å–ø–µ—Ö–µ:**
```
‚úÖ –ù–û–ß–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê: –í—Å–µ 15 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω—ã

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —à—Ç–∞—Ç–Ω–æ.
–°–ª–µ–¥—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –∑–∞–≤—Ç—Ä–∞ –≤ 06:00

‚è± 02.02.2026, 06:00 –ú–∏–Ω—Å–∫
```

### PATCH-3: –ö–æ–¥ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è

**–§–∞–π–ª:** `supabase/functions/nightly-system-health/index.ts`

–ó–∞–º–µ–Ω–∏—Ç—å –±–ª–æ–∫ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è `alertText` (—Å—Ç—Ä–æ–∫–∏ 197-226):

```typescript
// Build Russian-language message
const nowStr = new Date().toLocaleString('ru-RU', { 
  timeZone: 'Europe/Minsk',
  day: '2-digit',
  month: '2-digit', 
  year: 'numeric',
  hour: '2-digit',
  minute: '2-digit'
});

const isSuccess = failedChecks.length === 0;
const total = invariantsResult.summary?.total_checks || 0;
const durationSec = ((Date.now() - startTime) / 1000).toFixed(1);

let alertText = '';

if (isSuccess) {
  alertText = `‚úÖ –ù–û–ß–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê: –í—Å–µ ${total} —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω—ã\n\n`;
  alertText += `–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —à—Ç–∞—Ç–Ω–æ.\n`;
  alertText += `–°–ª–µ–¥—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –∑–∞–≤—Ç—Ä–∞ –≤ 06:00\n\n`;
} else {
  alertText = `üö® –ù–û–ß–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê: ${failedChecks.length} –∏–∑ ${total} —Å –æ—à–∏–±–∫–∞–º–∏\n\n`;
  alertText += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
  
  for (const check of failedChecks.slice(0, 5)) {
    const code = check.name.split(':')[0].trim();
    const translation = INVARIANT_TRANSLATIONS[code];
    
    if (translation) {
      alertText += `‚ùå ${translation.title} (${code})\n`;
      alertText += `   –ù–∞–π–¥–µ–Ω–æ: ${check.count}\n`;
      alertText += `   –ü—Ä–æ–±–ª–µ–º–∞: ${translation.explain}\n`;
      alertText += `   –î–µ–π—Å—Ç–≤–∏–µ: ${translation.action}\n\n`;
    } else {
      alertText += `‚ùå ${check.name}\n`;
      alertText += `   –ù–∞–π–¥–µ–Ω–æ: ${check.count}\n\n`;
    }
  }
  
  if (failedChecks.length > 5) {
    alertText += `... –∏ –µ—â—ë ${failedChecks.length - 5}\n\n`;
  }
  
  alertText += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
}

alertText += `‚è± ${nowStr} –ú–∏–Ω—Å–∫\n`;
alertText += `üìä –í—Ä–µ–º—è: ${durationSec} —Å–µ–∫\n`;
alertText += `üîó –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: /admin/system-health`;
```

---

## –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|-----------|
| `supabase/functions/nightly-system-health/index.ts` | PATCH-1, PATCH-2, PATCH-3: —Ä—É—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |

---

## DoD (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä—É—Ñ—ã)

### 1. –†—É—á–Ω–æ–π —Ç–µ—Å—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
–í—ã–∑–≤–∞—Ç—å:
```
POST /functions/v1/nightly-system-health
Body: {"source": "manual-test", "notify_owner": true}
```

### 2. –°–∫—Ä–∏–Ω—à–æ—Ç TG-—Å–æ–æ–±—â–µ–Ω–∏—è
–û–∂–∏–¥–∞–Ω–∏–µ: —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ –≤—Å–µ—Ö –∫–æ–¥–æ–≤
–í—Å–µ 15 –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —Ä—É—Å—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ó–æ–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏
- –°–µ–π—á–∞—Å: `Europe/London`
- –°—Ç–∞–Ω–µ—Ç: `Europe/Minsk` (06:00 –≤–º–µ—Å—Ç–æ 03:00)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ª–æ–≤–∞—Ä—è
–ö–∞–∂–¥—ã–π –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç –∏–º–µ–µ—Ç:
- `title`: –∫–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞)
- `explain`: —á—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç –¥–ª—è –±–∏–∑–Ω–µ—Å–∞
- `action`: —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
–ï—Å–ª–∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ª–æ–≤–∞—Ä–µ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∞–Ω–≥–ª–æ—è–∑—ã—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (fallback).
