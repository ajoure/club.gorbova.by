
# ĞŸĞ»Ğ°Ğ½: Training Quest â€” Ğ¨Ğ°Ğ³ 1

## Ğ¦ĞµĞ»ÑŒ
Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ñ‹Ğ¹ kvest-Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ ÑƒÑ€Ğ¾ĞºĞ¾Ğ² Ñ Ğ½Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ Ğ±Ğ»Ğ¾ĞºĞ°Ğ¼Ğ¸ (Video Unskippable, Diagnostic Table, Sequential Form) Ğ¸ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¾Ğ¹ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ.

---

## Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|-----------|--------|
| `training_lessons.published_at` | `date` (Ğ½ÑƒĞ¶ĞµĞ½ `timestamptz`) |
| `training_modules.published_at` | ĞĞµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ |
| `training_lessons.require_previous` | ĞĞµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ |
| `training_lessons.completion_mode` | ĞĞµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ |
| `lesson_progress_state` (Ğ½Ğ¾Ğ²Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°) | ĞĞµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ |
| Ğ‘Ğ»Ğ¾Ğº `quiz_survey` | Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚, Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ |
| Ğ‘Ğ»Ğ¾Ğº `video` | Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚, Ğ½Ğ¾ Ğ±ĞµĞ· Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ° Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° |
| Ğ‘Ğ»Ğ¾ĞºĞ¸ `diagnostic_table`, `sequential_form` | ĞĞµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‚ |

---

## A) ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ‘Ğ” (add-only)

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° 1: lesson_progress_state

```sql
CREATE TABLE lesson_progress_state (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  lesson_id uuid NOT NULL REFERENCES training_lessons(id) ON DELETE CASCADE,
  state_json jsonb NOT NULL DEFAULT '{}'::jsonb,
  completed_at timestamptz,
  created_at timestamptz NOT NULL DEFAULT now(),
  updated_at timestamptz NOT NULL DEFAULT now(),
  UNIQUE(user_id, lesson_id)
);

-- RLS
ALTER TABLE lesson_progress_state ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can manage own progress state"
  ON lesson_progress_state FOR ALL
  TO authenticated
  USING (auth.uid() = user_id)
  WITH CHECK (auth.uid() = user_id);

-- Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹
CREATE INDEX idx_lesson_progress_state_user_lesson 
  ON lesson_progress_state(user_id, lesson_id);

COMMENT ON TABLE lesson_progress_state IS 
  'Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ ĞºĞ²ĞµÑÑ‚Ğ°: Ñ€Ğ¾Ğ»ÑŒ, Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ²Ğ¸Ğ´ĞµĞ¾, Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ Point B Ğ¸ Ñ‚.Ğ´.';
```

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° state_json:**
```typescript
interface LessonProgressState {
  role?: string;                    // Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ°Ñ Ñ€Ğ¾Ğ»ÑŒ Ğ¸Ğ· quiz_survey
  videoProgress?: Record<string, number>; // blockId -> percent watched
  pointA_rows?: any[];              // Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹
  pointB_answers?: Record<string, string>; // ĞÑ‚Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° 10 ÑˆĞ°Ğ³Ğ¾Ğ² Point B
  currentStepIndex?: number;        // Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑˆĞ°Ğ³ ĞºĞ²ĞµÑÑ‚Ğ°
  completedSteps?: string[];        // ID Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½Ğ½Ñ‹Ñ… Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²
}
```

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° 2: Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ training_lessons

```sql
-- Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿ published_at Ğ½Ğ° timestamptz
ALTER TABLE training_lessons 
  ALTER COLUMN published_at TYPE timestamptz 
  USING CASE 
    WHEN published_at IS NOT NULL 
    THEN published_at::timestamp AT TIME ZONE 'Europe/Minsk'
    ELSE NULL 
  END;

-- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸
ALTER TABLE training_lessons
  ADD COLUMN IF NOT EXISTS require_previous boolean DEFAULT false,
  ADD COLUMN IF NOT EXISTS completion_mode text DEFAULT 'manual'
    CHECK (completion_mode IN ('manual', 'view_all_blocks', 'watch_video', 'kvest'));

COMMENT ON COLUMN training_lessons.require_previous IS 
  'Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ³Ğ¾ ÑƒÑ€Ğ¾ĞºĞ° Ğ´Ğ»Ñ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ';
COMMENT ON COLUMN training_lessons.completion_mode IS 
  'manual = Ñ€ÑƒÑ‡Ğ½Ğ°Ñ Ğ¾Ñ‚Ğ¼ĞµÑ‚ĞºĞ°, kvest = Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ ÑˆĞ°Ğ³Ğ¸ Ñ gate rules';
```

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° 3: Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ training_modules

```sql
ALTER TABLE training_modules
  ADD COLUMN IF NOT EXISTS published_at timestamptz;

COMMENT ON COLUMN training_modules.published_at IS 
  'Ğ”Ğ°Ñ‚Ğ°/Ğ²Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹';
```

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° 4: Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ lesson_blocks constraint

```sql
ALTER TABLE lesson_blocks 
  DROP CONSTRAINT IF EXISTS lesson_blocks_block_type_check;

ALTER TABLE lesson_blocks 
  ADD CONSTRAINT lesson_blocks_block_type_check 
  CHECK (block_type IN (
    'heading', 'text', 'accordion', 'tabs', 'spoiler', 'callout', 'quote',
    'video', 'audio', 'image', 'gallery', 'file',
    'button', 'embed', 'divider', 'timeline', 'steps',
    'quiz_single', 'quiz_multiple', 'quiz_true_false', 'quiz_fill_blank',
    'quiz_matching', 'quiz_sequence', 'quiz_hotspot', 'quiz_survey',
    'input_short', 'input_long', 'checklist', 'table_input', 'file_upload', 'rating',
    'container', 'columns', 'condition',
    -- NEW KVEST BLOCKS
    'video_unskippable',
    'diagnostic_table',
    'sequential_form'
  ));
```

---

## B) ĞĞ¾Ğ²Ñ‹Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸

### B1: VideoUnskippableBlock

**ĞŸÑƒÑ‚ÑŒ:** `src/components/admin/lesson-editor/blocks/VideoUnskippableBlock.tsx`

**ĞŸĞ¾Ğ»Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ°:**
```typescript
interface VideoUnskippableContent {
  url: string;
  provider?: 'youtube' | 'vimeo' | 'kinescope';
  title?: string;
  threshold_percent: number;  // default 95
  required: boolean;          // default true
}
```

**Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:**
- Ğ’ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ² Kinescope API Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°
- ĞŸĞ¾ĞºĞ° `watchedPercent < threshold` â†’ `isComplete = false`
- Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ² `lesson_progress_state.state_json.videoProgress[blockId]`
- ĞĞµ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ¼Ğ°Ñ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ¿ĞµÑ€Ñ‘Ğ´ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)

**UI:**
```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¬ ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ²Ğ¸Ğ´ĞµĞ¾                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                   [VIDEO PLAYER]                        â”‚ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ ğŸ“Š ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµĞ½Ğ¾: 47% Ğ¸Ğ· 95% Ñ‚Ñ€ĞµĞ±ÑƒĞµĞ¼Ñ‹Ñ…                        â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                                      â”‚
â”‚                                                             â”‚
â”‚ âš ï¸ Ğ”Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚Ğµ Ğ²Ğ¸Ğ´ĞµĞ¾, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### B2: DiagnosticTableBlock (Point A)

**ĞŸÑƒÑ‚ÑŒ:** `src/components/admin/lesson-editor/blocks/DiagnosticTableBlock.tsx`

**ĞŸĞ¾Ğ»Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ°:**
```typescript
interface DiagnosticTableColumn {
  id: string;
  name: string;
  type: 'text' | 'number' | 'select' | 'computed';
  options?: string[];           // Ğ´Ğ»Ñ select
  formula?: string;             // Ğ´Ğ»Ñ computed, e.g. "col3 / col4"
  width?: number;
  required?: boolean;
}

interface DiagnosticTableContent {
  title?: string;
  instruction?: string;
  columns: DiagnosticTableColumn[];
  minRows: number;              // default 1
  showAggregates: boolean;      // Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ ÑÑƒĞ¼Ğ¼Ñ‹/ÑÑ€ĞµĞ´Ğ½Ğ¸Ğµ
  submitButtonText: string;     // "Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°"
}
```

**Ğ”ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ñ‹Ğµ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸ (Ğ¿Ğ¾ Ğ¢Ğ—):**
1. Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ´Ğ¾Ñ…Ğ¾Ğ´Ğ° (text)
2. Ğ¢Ğ¸Ğ¿ â€” Ğ½Ğ°Ğ¹Ğ¼/ĞºĞ»Ğ¸ĞµĞ½Ñ‚ (select: Ğ½Ğ°Ğ¹Ğ¼, ĞºĞ»Ğ¸ĞµĞ½Ñ‚)
3. Ğ”Ğ¾Ñ…Ğ¾Ğ´ Ğ² Ğ¼ĞµÑÑÑ† (number)
4. Ğ§Ğ°ÑÑ‹ Ğ¿Ğ¾ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°Ğ¼ (number)
5. Ğ§Ğ°ÑÑ‹ Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑĞºĞ¸/Ñ‚Ñ€ĞµĞ²Ğ¾Ğ³Ğ¸ (number)
6. Ğ”Ğ¾Ñ…Ğ¾Ğ´ Ğ·Ğ° Ñ‡Ğ°Ñ (computed: col3 / (col4 + col5))
7. Ğ®Ñ€Ğ¸Ğ´Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ€Ğ¸ÑĞºĞ¸ (select: Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹, ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹, Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹)
8. Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ğµ Ñ€Ğ¸ÑĞºĞ¸ (select: Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹, ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹, Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹)
9. Ğ ĞµĞ¿ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ñ€Ğ¸ÑĞºĞ¸ (select: Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹, ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹, Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹)
10. Ğ­Ğ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° (number 1-10)
11. ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ (text)

**Gate rule:** `rows.length >= minRows` Ğ˜ ĞºĞ½Ğ¾Ğ¿ĞºĞ° "Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°" Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ°

**UI:**
```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ² Ğ´Ğ¾Ñ…Ğ¾Ğ´Ğ°                         â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ â”‚Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº â”‚  Ğ¢Ğ¸Ğ¿    â”‚ Ğ”Ğ¾Ñ…Ğ¾Ğ´   â”‚ Ğ§Ğ°ÑÑ‹    â”‚ $/Ñ‡Ğ°Ñ   â”‚ ...     â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚ â”‚ ĞšĞ»Ğ¸ĞµĞ½Ñ‚1 â”‚ ĞºĞ»Ğ¸ĞµĞ½Ñ‚  â”‚ 2000    â”‚  40     â”‚  50     â”‚         â”‚
â”‚ â”‚ Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°  â”‚  Ğ½Ğ°Ğ¹Ğ¼   â”‚ 1500    â”‚  80     â”‚  18.75  â”‚         â”‚
â”‚ â”‚ + Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ¾ĞºÑƒ                               â”‚         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                             â”‚
â”‚ ğŸ“ˆ Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: 3500 BYN/Ğ¼ĞµÑ, 120 Ñ‡Ğ°ÑĞ¾Ğ², ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ´Ğ¾Ñ…Ğ¾Ğ´/Ñ‡Ğ°Ñ: 29.17 â”‚
â”‚                                                             â”‚
â”‚ [ âœ… Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ° Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ° ]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### B3: SequentialFormBlock (Point B)

**ĞŸÑƒÑ‚ÑŒ:** `src/components/admin/lesson-editor/blocks/SequentialFormBlock.tsx`

**ĞŸĞ¾Ğ»Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ°:**
```typescript
interface FormStep {
  id: string;
  title: string;
  description: string;
  inputType: 'textarea' | 'text' | 'number' | 'select';
  options?: string[];
  required: boolean;
  helperText?: string;
  helperTextByRole?: Record<string, string>; // Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ¸ Ğ¿Ğ¾ Ñ€Ğ¾Ğ»ÑĞ¼
}

interface SequentialFormContent {
  title?: string;
  steps: FormStep[];
  submitButtonText: string;     // "Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ° Ñ‚Ğ¾Ñ‡ĞºĞ¸ B ÑÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°"
}
```

**Ğ”ĞµÑ„Ğ¾Ğ»Ñ‚Ğ½Ñ‹Ğµ 10 ÑˆĞ°Ğ³Ğ¾Ğ² (Ğ¿Ğ¾ Ğ¢Ğ—):**
1. Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ğ°Ñ Ñ†ĞµĞ»ÑŒ â€” ĞšĞ°ĞºĞ¾Ğ¹ Ğ´Ğ¾Ñ…Ğ¾Ğ´ Ğ² Ğ¼ĞµÑÑÑ† Ñ Ñ…Ğ¾Ñ‡Ñƒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· 12 Ğ¼ĞµÑÑÑ†ĞµĞ²?
2. Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ â€” Ğ—Ğ° ÑÑ‡Ñ‘Ñ‚ Ñ‡ĞµĞ³Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ ÑÑ‚Ğ¾Ñ‚ Ğ´Ğ¾Ñ…Ğ¾Ğ´?
3. ĞšĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ â€” Ğ¡ ĞºĞ°ĞºĞ¸Ğ¼Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸ Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ?
4. Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ â€” ĞšĞ°Ğº Ğ²Ñ‹Ğ³Ğ»ÑĞ´Ğ¸Ñ‚ Ğ¼Ğ¾Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚?
5. Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° â€” Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‡Ğ°ÑĞ¾Ğ² Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ Ñ Ğ³Ğ¾Ñ‚Ğ¾Ğ²(Ğ°) Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ?
6. Ğ Ğ¾Ğ»ÑŒ Ğ² Ğ±Ğ¸Ğ·Ğ½ĞµÑĞµ â€” Ğ§Ñ‚Ğ¾ Ñ Ğ´ĞµĞ»Ğ°Ñ Ğ»Ğ¸Ñ‡Ğ½Ğ¾, Ğ° Ñ‡Ñ‚Ğ¾ Ğ½Ğµ Ğ´ĞµĞ»Ğ°Ñ?
7. ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°/Ñ€ĞµÑÑƒÑ€ÑÑ‹ â€” ĞÑƒĞ¶Ğ½Ñ‹ Ğ»Ğ¸ Ğ»ÑĞ´Ğ¸, ÑĞµÑ€Ğ²Ğ¸ÑÑ‹, Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ?
8. Ğ Ğ¸ÑĞºĞ¸ â€” ĞšĞ°ĞºĞ¸Ğµ Ñ€Ğ¸ÑĞºĞ¸ Ñ Ğ¾ÑĞ¾Ğ·Ğ½Ğ°Ğ½Ğ½Ğ¾ Ğ±ĞµÑ€Ñƒ Ğ¸ ĞºĞ°ĞºĞ¸Ğµ Ğ¸ÑĞºĞ»ÑÑ‡Ğ°Ñ?
9. ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ â€” ĞÑ‚ Ñ‡ĞµĞ³Ğ¾ Ñ Ğ¾Ñ‚ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑÑŒ Ñ€Ğ°Ğ´Ğ¸ ÑÑ‚Ğ¾Ğ¹ Ñ†ĞµĞ»Ğ¸?
10. ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ â€” ĞŸĞ¾ ĞºĞ°ĞºĞ¸Ğ¼ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ°Ğ¼ Ñ Ğ¿Ğ¾Ğ¹Ğ¼Ñƒ, Ñ‡Ñ‚Ğ¾ Ñ‚Ğ¾Ñ‡ĞºĞ° B Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚Ğ°?

**Gate rule:** Ğ’ÑĞµ 10 ÑˆĞ°Ğ³Ğ¾Ğ² Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹ Ğ˜ ĞºĞ½Ğ¾Ğ¿ĞºĞ° "Ğ¡Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°" Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ°

**UI:**
```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¯ Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ° Ñ‚Ğ¾Ñ‡ĞºĞ¸ B                          Ğ¨Ğ°Ğ³ 3 Ğ¸Ğ· 10     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ â— â— â— â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹                                         â”‚
â”‚                                                             â”‚
â”‚ 3ï¸âƒ£ ĞšĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ                                        â”‚
â”‚                                                             â”‚
â”‚ Ğ¡ ĞºĞ°ĞºĞ¸Ğ¼Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸ Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ (Ñ‚Ğ¸Ğ¿, Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±, Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚)?        â”‚
â”‚                                                             â”‚
â”‚ ğŸ’¡ ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ° Ğ´Ğ»Ñ Ñ„Ñ€Ğ¸Ğ»Ğ°Ğ½ÑĞµÑ€Ğ°:                                â”‚
â”‚ ĞĞ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°: ĞµĞ³Ğ¾ Ğ±Ğ¸Ğ·Ğ½ĞµÑ, Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±,            â”‚
â”‚ ĞºĞ°ĞºĞ¸Ğµ ÑƒÑĞ»ÑƒĞ³Ğ¸ ĞµĞ¼Ñƒ Ğ½ÑƒĞ¶Ğ½Ñ‹...                                   â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â”‚ [textarea]                                              â”‚ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ [â† ĞĞ°Ğ·Ğ°Ğ´]                                      [Ğ”Ğ°Ğ»ÑŒÑˆĞµ â†’]   â”‚
â”‚                                                             â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚ ĞŸĞ¾ÑĞ»Ğµ ÑˆĞ°Ğ³Ğ° 10:                                              â”‚
â”‚ [ âœ… Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ° Ñ‚Ğ¾Ñ‡ĞºĞ¸ B ÑÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° ]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## C) Kvest Flow Engine

### C1: Ğ¥ÑƒĞº useLessonProgressState

**ĞŸÑƒÑ‚ÑŒ:** `src/hooks/useLessonProgressState.tsx`

```typescript
interface LessonProgressState {
  role?: string;
  videoProgress?: Record<string, number>;
  pointA_rows?: any[];
  pointB_answers?: Record<string, string>;
  currentStepIndex?: number;
  completedSteps?: string[];
}

function useLessonProgressState(lessonId: string) {
  // CRUD Ğ´Ğ»Ñ lesson_progress_state
  // ĞĞ²Ñ‚Ğ¾ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸ÑÑ… (debounced)
  return {
    state: LessonProgressState,
    loading: boolean,
    updateState: (partial) => void,
    markBlockCompleted: (blockId) => void,
    isBlockCompleted: (blockId) => boolean,
    reset: () => void,
  };
}
```

### C2: ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ KvestLessonView

**ĞŸÑƒÑ‚ÑŒ:** `src/components/lesson/KvestLessonView.tsx`

Ğ—Ğ°Ğ¼ĞµĞ½ÑĞµÑ‚ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ Ğ±Ğ»Ğ¾ĞºĞ¾Ğ² Ğ´Ğ»Ñ `completion_mode='kvest'`:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“š Ğ£Ñ€Ğ¾Ğº: Ğ¢ĞµÑÑ‚ "Ğ’ ĞºĞ°ĞºĞ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸..."           Ğ¨Ğ°Ğ³ 2 Ğ¸Ğ· 5       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â— â— â—‹ â—‹ â—‹                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ [Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ±Ğ»Ğ¾Ğº Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ÑÑ Ğ·Ğ´ĞµÑÑŒ]                           â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [â† ĞĞ°Ğ·Ğ°Ğ´]                                      [Ğ”Ğ°Ğ»ÑŒÑˆĞµ â†’]   â”‚
â”‚                                   (disabled ĞµÑĞ»Ğ¸ gate fail) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:**
1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ `blocks` ÑƒÑ€Ğ¾ĞºĞ°
2. Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ "ÑˆĞ°Ğ³Ğ¾Ğ²Ñ‹Ğµ" Ğ±Ğ»Ğ¾ĞºĞ¸ (heading Ğ½Ğµ ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ÑÑ ÑˆĞ°Ğ³Ğ¾Ğ¼)
3. ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼ Ğ¿Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ Ğ±Ğ»Ğ¾ĞºÑƒ
4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ gate rule Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ°:
   - `quiz_survey` â†’ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½ Ğ¾Ñ‚Ğ²ĞµÑ‚?
   - `video_unskippable` â†’ threshold Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚?
   - `diagnostic_table` â†’ ĞµÑÑ‚ÑŒ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ + ĞºĞ½Ğ¾Ğ¿ĞºĞ° Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ°?
   - `sequential_form` â†’ Ğ²ÑĞµ ÑˆĞ°Ğ³Ğ¸ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹ + ĞºĞ½Ğ¾Ğ¿ĞºĞ° Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ°?
5. Ğ•ÑĞ»Ğ¸ gate pass â†’ "Ğ”Ğ°Ğ»ÑŒÑˆĞµ" Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°
6. ĞŸÑ€Ğ¸ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ° Ğ¸ ĞµĞ³Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğ¸ â†’ ÑƒÑ€Ğ¾Ğº completed

### C3: ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ LibraryLesson.tsx

Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒÑĞ»Ğ¾Ğ²Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³:

```tsx
if (currentLesson.completion_mode === 'kvest') {
  return (
    <KvestLessonView 
      lesson={currentLesson}
      blocks={blocks}
      module={module}
      onComplete={handleComplete}
    />
  );
}

// Ğ˜Ğ½Ğ°Ñ‡Ğµ â€” ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³
```

---

## D) Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ quiz_survey Ñ Ñ€Ğ¾Ğ»ÑŒÑ

### D1: ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ QuizSurveyBlock

Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ñ€Ğ¾Ğ»Ğ¸ Ğ² `lesson_progress_state`:

```typescript
const handleSubmitResults = async () => {
  setShowResults(true);
  
  // ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ¿Ñ€ĞµĞ¾Ğ±Ğ»Ğ°Ğ´Ğ°ÑÑ‰ÑƒÑ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ ĞºĞ°Ğº "Ñ€Ğ¾Ğ»ÑŒ"
  const role = dominantCategories[0] || null;
  
  // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² progress state (Ğ´Ğ»Ñ kvest)
  if (onRoleSelected && role) {
    onRoleSelected(role);
  }
  
  if (onSubmit) {
    onSubmit({ answers, isCompleted: true, role }, true, ...);
  }
};
```

### D2: helperText Ğ¿Ğ¾ Ñ€Ğ¾Ğ»Ğ¸

Ğ’ `SequentialFormBlock` Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ±Ğ»Ğ¾ĞºĞ°Ñ… Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ:

```tsx
const { state } = useLessonProgressState(lessonId);
const userRole = state?.role;

// Ğ’ UI:
{step.helperTextByRole?.[userRole] || step.helperText}
```

---

## E) ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Admin UI

### E1: AdminTrainingLessons.tsx

Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ñƒ ÑƒÑ€Ğ¾ĞºĞ°:

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğ¸ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ ğŸ“… Ğ”Ğ°Ñ‚Ğ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ                                            â”‚
â”‚ [  15.02.2026  ] [ 10:00 ] [ Europe/Minsk â–¼ ]              â”‚
â”‚                                                             â”‚
â”‚ ğŸ”— ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ                                       â”‚
â”‚ â˜‘ï¸ Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ³Ğ¾ ÑƒÑ€Ğ¾ĞºĞ°                  â”‚
â”‚                                                             â”‚
â”‚ âœ… Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ                                         â”‚
â”‚ â—‹ Ğ ÑƒÑ‡Ğ½Ğ°Ñ Ğ¾Ñ‚Ğ¼ĞµÑ‚ĞºĞ°                                            â”‚
â”‚ â—‹ ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ²ÑĞµÑ… Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²                                      â”‚
â”‚ â—‹ Ğ”Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ²Ğ¸Ğ´ĞµĞ¾                                          â”‚
â”‚ â— ĞšĞ²ĞµÑÑ‚ (Ğ¿Ğ¾ÑˆĞ°Ğ³Ğ¾Ğ²Ğ¾Ğµ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ)                             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### E2: LessonBlockEditor.tsx

Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸ Ğ² Ğ¼ĞµĞ½Ñ:

```typescript
const blockTypeConfig = {
  // ... existing
  video_unskippable: { 
    icon: Video, 
    label: "Ğ’Ğ¸Ğ´ĞµĞ¾ (Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ)", 
    color: "bg-red-500/10 text-red-600", 
    category: 'media' 
  },
  diagnostic_table: { 
    icon: Table, 
    label: "Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°", 
    color: "bg-emerald-500/10 text-emerald-600", 
    category: 'input' 
  },
  sequential_form: { 
    icon: ListOrdered, 
    label: "ĞŸĞ¾ÑˆĞ°Ğ³Ğ¾Ğ²Ğ°Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°", 
    color: "bg-indigo-500/10 text-indigo-600", 
    category: 'input' 
  },
};
```

---

## F) Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğº ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ/Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ

| Ğ¤Ğ°Ğ¹Ğ» | Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ |
|------|----------|
| `supabase/migrations/XXXX_kvest_step1.sql` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ (Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ‘Ğ”) |
| `src/hooks/useLessonProgressState.tsx` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| `src/components/lesson/KvestLessonView.tsx` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| `src/components/admin/lesson-editor/blocks/VideoUnskippableBlock.tsx` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| `src/components/admin/lesson-editor/blocks/DiagnosticTableBlock.tsx` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| `src/components/admin/lesson-editor/blocks/SequentialFormBlock.tsx` | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| `src/hooks/useLessonBlocks.tsx` | Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ 3 Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ° |
| `src/components/admin/lesson-editor/LessonBlockEditor.tsx` | Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ±Ğ»Ğ¾ĞºĞ¾Ğ² |
| `src/components/lesson/LessonBlockRenderer.tsx` | Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ Ğ±Ğ»Ğ¾ĞºĞ¾Ğ² |
| `src/pages/LibraryLesson.tsx` | Ğ£ÑĞ»Ğ¾Ğ²Ğ½Ñ‹Ğ¹ kvest-Ñ€ĞµĞ¶Ğ¸Ğ¼ |
| `src/pages/LibraryModule.tsx` | ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¼ĞºĞ¾Ğ² |
| `src/pages/admin/AdminTrainingLessons.tsx` | ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑƒÑ€Ğ¾ĞºĞ° |
| `src/hooks/useTrainingLessons.tsx` | ĞĞ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ |

---

## G) DoD (Definition of Done)

| # | ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° | ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ |
|---|----------|----------|
| 1 | ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ñ„Ğ¾Ñ€Ğ¼Ñƒ ÑƒÑ€Ğ¾ĞºĞ° | Ğ’Ğ¸Ğ´Ğ½Ñ‹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸: Ğ´Ğ°Ñ‚Ğ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ, require_previous, completion_mode |
| 2 | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑƒÑ€Ğ¾Ğº Ñ `completion_mode='kvest'` | Ğ£Ñ€Ğ¾Ğº ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ |
| 3 | Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ±Ğ»Ğ¾ĞºĞ¸: quiz_survey, video_unskippable, diagnostic_table, sequential_form | Ğ‘Ğ»Ğ¾ĞºĞ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹ Ğ² Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€Ğµ |
| 4 | ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ ÑƒÑ€Ğ¾Ğº ĞºĞ°Ğº ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚ | ĞšĞ²ĞµÑÑ‚-Ñ€ĞµĞ¶Ğ¸Ğ¼: ÑˆĞ°Ğ³Ğ¸ 1/N, ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ ĞĞ°Ğ·Ğ°Ğ´/Ğ”Ğ°Ğ»ÑŒÑˆĞµ |
| 5 | ĞŸÑ€Ğ¾Ğ¹Ñ‚Ğ¸ quiz â†’ Ñ€Ğ¾Ğ»ÑŒ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ | role Ğ¿Ğ¾ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ² state_json |
| 6 | Ğ’Ğ¸Ğ´ĞµĞ¾: Ğ½Ğµ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚ threshold | ĞšĞ½Ğ¾Ğ¿ĞºĞ° "Ğ”Ğ°Ğ»ÑŒÑˆĞµ" disabled |
| 7 | Ğ’Ğ¸Ğ´ĞµĞ¾: Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚ threshold | ĞšĞ½Ğ¾Ğ¿ĞºĞ° "Ğ”Ğ°Ğ»ÑŒÑˆĞµ" enabled |
| 8 | Diagnostic Table: 0 ÑÑ‚Ñ€Ğ¾Ğº | ĞšĞ½Ğ¾Ğ¿ĞºĞ° "Ğ”Ğ°Ğ»ÑŒÑˆĞµ" disabled |
| 9 | Diagnostic Table: â‰¥1 ÑÑ‚Ñ€Ğ¾ĞºĞ° + "Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°" | ĞšĞ½Ğ¾Ğ¿ĞºĞ° "Ğ”Ğ°Ğ»ÑŒÑˆĞµ" enabled |
| 10 | Sequential Form: Ğ½Ğµ Ğ²ÑĞµ ÑˆĞ°Ğ³Ğ¸ | ĞĞµĞ»ÑŒĞ·Ñ Ğ¿ĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğº Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ ĞºĞ½Ğ¾Ğ¿ĞºĞµ |
| 11 | Sequential Form: Ğ²ÑĞµ 10 ÑˆĞ°Ğ³Ğ¾Ğ² + "Ğ¡Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°" | Ğ‘Ğ»Ğ¾Ğº Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½ |
| 12 | Ğ£Ñ€Ğ¾Ğº completed | Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ¾Ğ³Ğ´Ğ° Ğ²ÑĞµ Ğ±Ğ»Ğ¾ĞºĞ¸ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ñ‹ |
| 13 | require_previous=true | Ğ£Ñ€Ğ¾Ğº Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ ĞµÑĞ»Ğ¸ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹ Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½ |
| 14 | Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ÑƒÑ€Ğ¾ĞºĞ¾Ğ² | Ğ—Ğ°Ğ¼ĞºĞ¸ Ğ¸ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ |
| 15 | Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ | UI-ÑĞºÑ€Ğ¸Ğ½Ñ‹, diff-summary, ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² |

---

## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ

- ĞĞ¸ĞºĞ°ĞºĞ¸Ñ… Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… RLS/RBAC
- ĞĞ¾Ğ²Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `lesson_progress_state` Ñ RLS "Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸"
- Add-only Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚Ğ°Ğ¼Ğ¸
- ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ: ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ ÑƒÑ€Ğ¾ĞºĞ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ ĞºĞ°Ğº Ñ€Ğ°Ğ½ÑŒÑˆĞµ
- ĞĞ´Ğ¼Ğ¸Ğ½ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ğ²ÑĞµ ÑƒÑ€Ğ¾ĞºĞ¸ Ğ±ĞµĞ· Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğº
- Ğ’ÑĞµ Ñ‚ĞµĞºÑÑ‚Ñ‹ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ
